(()=>{"use strict";function e(e,t){return chrome.i18n.getMessage(e,t)||e}const t={get:e,localize:function(t=document){t.querySelectorAll("[data-i18n]").forEach(t=>{const n=t.getAttribute("data-i18n");n&&(t.textContent=e(n))}),t.querySelectorAll("[data-i18n-attr]").forEach(t=>{const n=t.getAttribute("data-i18n-attr");if(n)for(const a of n.split(";")){const[n,r]=a.split(":").map(e=>e?.trim());n&&r&&t.setAttribute(n,e(r))}})}},n="PING",a="TOGGLE_SELECT",r="RENDER",o="CLEAR",i="SELECTED",c="CLOSE_PANEL";function s(e){return!e||e.startsWith("chrome://")||e.startsWith("edge://")||e.startsWith("about:")||e.startsWith("moz-extension://")}const d="spsk:panel-content:v1";class l{rpc;constructor(e){this.rpc=e}send(e){const t={id:crypto.randomUUID(),expectReply:!1,...e};return this.rpc.send(t)}render(e){return this.send({type:r,payload:{items:e}})}toggleSelect(e){return this.send({type:a,payload:{enabled:e}})}clear(){return this.send({type:o})}ping(){const e={id:crypto.randomUUID(),expectReply:!0,type:n};return this.rpc.send(e,5e3)}}class m{port;pending=new Map;constructor(e){this.port=e,this.port.onMessage.addListener(e=>{(function(e){return"object"==typeof e&&null!==e&&"id"in e&&"ok"in e})(e)&&(this.pending.get(e.id)?.(e),this.pending.delete(e.id))}),this.port.onDisconnect.addListener(()=>{for(const[,e]of this.pending)e({id:"",ok:!1,error:"disconnected"});this.pending.clear()})}send(e,t=5e3){return new Promise(n=>{if(e.expectReply){const a=setTimeout(()=>{this.pending.delete(e.id),n(void 0)},t);this.pending.set(e.id,e=>{clearTimeout(a),n(e)})}try{this.port.postMessage(e)}catch{return e.expectReply&&this.pending.delete(e.id),void n(void 0)}e.expectReply||n(void 0)})}}function u(){const e=chrome.runtime.lastError;return e?new Error(e.message||String(e)):null}async function g(e,t,n){return await new Promise((a,r)=>{chrome.debugger.sendCommand(e,t,n??{},e=>{const t=u();t?r(t):a(e??{})})})}const p="screenStateByPage";async function h(){return(await chrome.storage.local.get(p))[p]??{}}async function y(e){return(await h())[e]??{items:[],nextId:1,nextLabel:1}}async function b(e,t){const n=await h();n[e]=t,await async function(e){await chrome.storage.local.set({[p]:e})}(n)}const f="CONNECTED",w={RESTRICTED:"status_restricted",CONNECTING:"status_connecting",CONNECTED:"status_connected",DISCONNECTED:"status_disconnected"},E={RESTRICTED:{body:["bg-amber-50","border-amber-200","text-amber-700","dark:bg-amber-950","dark:border-amber-900/50","dark:text-amber-300"],dot:["bg-amber-500"]},CONNECTING:{body:["bg-sky-50","border-sky-200","text-sky-700","dark:bg-sky-950","dark:border-sky-900/50","dark:text-sky-300"],dot:["bg-sky-500"]},CONNECTED:{body:["bg-emerald-50","border-emerald-200","text-emerald-700","dark:bg-emerald-950","dark:border-emerald-900/50","dark:text-emerald-300"],dot:["bg-emerald-500"]},DISCONNECTED:{body:["bg-rose-50","border-rose-200","text-rose-700","dark:bg-rose-950","dark:border-rose-900/50","dark:text-rose-300"],dot:["bg-rose-500"]}},x=document.getElementById("status"),C=document.getElementById("toggle-select-icon"),I=document.getElementById("toggle-select-label"),v=document.getElementById("select-count"),k=document.getElementById("select-empty"),N=document.getElementById("select-list"),S=["inline-flex","items-center","gap-1","rounded-full","border","px-2","py-1","text-xs","transition-colors"],D=["inline-block","w-3","h-3","rounded-full"],L=["bg-emerald-500"],T=["bg-slate-300"];function M(e){const n=E[e];x.className="",x.classList.add(...S,...n.body);const a=document.createElement("span");a.classList.add("h-1.5","w-1.5","rounded-full",...n.dot);const r=document.createElement("span");var o;r.textContent=function(e){const n=w[e];return t.get(n)||n}(e),x.replaceChildren(a,r),o=e!==f,document.querySelectorAll("button").forEach(e=>e.disabled=o)}function R(e){C.className="",C.classList.add(...D,...e?L:T),I.textContent=t.get(e?"toggle_on":"toggle_off")}function O(e){const t=0===e.length;if(v.textContent=String(e.length),t)return k.classList.remove("hidden"),void N.replaceChildren();k.classList.add("hidden");const n=document.createDocumentFragment();for(const t of e){const e=document.createElement("li");e.className="group flex items-center gap-3 p-3 hover:bg-slate-50 dark:hover:bg-slate-800/60",e.dataset.id=String(t.id);const a=document.createElement("span");a.className="inline-flex h-6 w-6 items-center justify-center rounded-md bg-indigo-600/10 text-indigo-700 dark:text-indigo-300 text-xs font-semibold",a.textContent=String(t.label);const r=document.createElement("div");r.className="min-w-0 flex-1";const o=document.createElement("div");o.className="text-sm font-medium truncate",o.textContent=t.anchor.value,r.append(o),e.append(a,r),n.appendChild(e)}N.replaceChildren(n)}const B=document.getElementById("toggle-select"),P=document.getElementById("clear"),$=document.getElementById("capture");let A=null,_="",q=!1;(async function(){t.localize(document);const e=await async function(){return(await chrome.tabs.query({active:!0,currentWindow:!0}))[0]}();if(!e?.id||s(e.url))return M("RESTRICTED");A=e.id,_=function(e,t=!1){try{const n=new URL(e);return t?`${n.origin}${n.pathname}${n.search}${n.hash}`:`${n.origin}${n.pathname}${n.search}`}catch{return e}}(e.url),M("CONNECTING");const n=await async function(e){await chrome.scripting.executeScript({target:{tabId:e},files:["content/main.js"]}).catch(()=>{});const t=chrome.tabs.connect(e,{name:d}),n=new m(t),a=new l(n),r=[];return t.onDisconnect.addListener(()=>r.forEach(e=>e())),{api:a,port:t,rpc:n,onDisconnect:e=>r.push(e),dispose:()=>{try{t.disconnect()}catch{}}}}(A);n.onDisconnect(()=>{M("DISCONNECTED"),q=!1,R(q)}),n.port.onMessage.addListener(async e=>{if(e&&e.type&&e.type===i){const t=await async function(e,t){const n=await y(e),a=Array.from(new Set(t.map(e=>e.value))).map(e=>t.find(t=>t.value===e)).filter(Boolean),r=[],o=[];for(const e of a){const t=n.items.find(t=>t.anchor.kind===e.kind&&t.anchor.value===e.value);t?r.push(t.id):o.push({anchor:e})}const i={};return r.length&&(i.removedIds=r),o.length&&(i.added=o),async function(e,t){const n=await y(e),a=!(!t.removedIds||!t.removedIds.length);if(t.removedIds?.length){const e=new Set(t.removedIds);n.items=n.items.filter(t=>!e.has(t.id))}if(t.updated?.length){const e=new Map(n.items.map(e=>[e.id,e]));for(const n of t.updated){const t=e.get(n.id);t&&("number"==typeof n.label&&(t.label=n.label),n.anchor&&(t.anchor=n.anchor),n.meta&&(t.meta=n.meta))}}if(t.added?.length)for(const e of t.added){const t={id:n.nextId++,label:"number"==typeof e.label?e.label:n.nextLabel++,anchor:e.anchor,...e.meta?{meta:e.meta}:{}};n.items.push(t)}return a&&function(e){e.items.forEach((e,t)=>{e.label=t+1}),e.nextLabel=e.items.length+1}(n),await b(e,n),n}(e,i)}(_,e.payload.anchors);O(t.items),await n.api.render(t.items)}}),chrome.runtime.onMessage.addListener(e=>{e?.type===c&&(null!==A&&e.payload?.tabId!==A||window.close())});const a=await y(_);await n.api.render(a.items),O(a.items),M(f),B.onclick=async()=>{q=!q,R(q),await n.api.toggleSelect(q)},P.onclick=async()=>{await b(_,{items:[],nextId:1,nextLabel:1}),O([]),await n.api.clear()},$.onclick=async()=>{try{await async function(e){const t=await chrome.tabs.get(e.tabId);if(!t.id||s(t.url))return void console.warn("Capturing is not possible due to restricted URL:",t.url);const n={tabId:t.id},a=e.format??"png",r=e.settleMs??500,o=e.scale??1;await async function(e){await new Promise((t,n)=>{chrome.debugger.attach(e,"1.3",()=>{const e=u();e?n(e):t()})})}(n);try{await g(n,"Page.enable"),(e.bringToFront??1)&&await g(n,"Page.bringToFront");const i=await g(n,"Page.getLayoutMetrics"),c=Math.max(1,0|Math.ceil(i.cssContentSize?.width??1)),s=Math.max(1,0|Math.ceil(i.cssContentSize?.height??1));await g(n,"Emulation.setDeviceMetricsOverride",{width:c,height:s,deviceScaleFactor:1,mobile:!1,screenWidth:c,screenHeight:s,positionX:0,positionY:0}),await g(n,"Runtime.evaluate",{expression:"window.scrollTo(0,0)"}),await new Promise(e=>setTimeout(e,r));const d={format:a,fromSurface:!0,captureBeyondViewport:!0,clip:{x:0,y:0,width:c,height:s,scale:o}};"jpeg"===a&&"number"==typeof e.quality&&(d.quality=Math.min(100,Math.max(0,Math.round(e.quality))));const{data:l}=await g(n,"Page.captureScreenshot",d),m=`data:${"png"===a?"image/png":"image/jpeg"};base64,${l}`,u=e.filename??function(e,t){let n=(e.title&&e.title.trim()?e.title:"")||(()=>{try{return new URL(e.url??"").host||"page"}catch{return"page"}})();return n=n.replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g," ").trim(),n.length>80&&(n=n.slice(0,80)),`${n}-${(new Date).toISOString().replace(/[:.]/g,"-")}.${t}`}(t,a);return await chrome.downloads.download({url:m,filename:u,saveAs:!1})}finally{try{await g(n,"Emulation.clearDeviceMetricsOverride")}catch{}try{await async function(e){await new Promise(t=>{chrome.debugger.detach(e,()=>t())})}(n)}catch{}}}({tabId:A})}catch(e){console.error("Full capture failed",e)}}})().catch(console.error)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SThOLE1BQVEsTUFDMUMsQ0FDQSxNQUNJLE1BQU8sTUFDWCxDQUNILEVBUG1CLEdBWXBCLE9BSkFGLEVBQTJCQSxFQXBCbEJHLFFBQVEsZ0JBQWlCLEtBQUtBLFFBQVEsT0FBUSxLQUFLbk8sT0FxQnhEZ08sRUFBS25ILE9BQVMsS0FDZG1ILEVBQU9BLEVBQUtJLE1BQU0sRUFBRyxLQUVsQixHQUFHSixNQURDLElBQUlLLE1BQU9DLGNBQWNILFFBQVEsUUFBUyxRQUM3Qm5DLEdBQzVCLENBbUQwQ3VDLENBQWFyRyxFQUFLOEQsR0FNcEQsYUFMeUJqTixPQUFPeVAsVUFBVUMsU0FBUyxDQUMvQ3JPLE1BQ0EyTixXQUNBVyxRQUFRLEdBR2hCLENBQ0EsUUFFSSxVQUNVL04sRUFBSzRDLEVBQVEsdUNBQ3ZCLENBQ0EsTUFBb0IsQ0FFcEIsVVBsRURELGVBQXNCQyxTQUNuQixJQUFJZixRQUFTSixJQUNmckQsT0FBTzRFLFNBQVNnTCxPQUFPcEwsRUFBUSxJQUFNbkIsTUFFN0MsQ08rRGtCdU0sQ0FBT3BMLEVBQ2pCLENBQ0EsTUFBb0IsQ0FDeEIsQ0FDSixDSDVCa0JxTCxDQUFnQixDQUFFNUYsTUFBT2pCLEdBQ25DLENBQ0EsTUFBTzhHLEdBQ0gvQyxRQUFReEosTUFBTSxzQkFBdUJ1TSxFQUN6QyxFQUVSLEVBckVBdkgsR0FBTzhCLE1BQU0wQyxRQUFReEosTSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2NvbW1vbi9pMThuLnRzIiwid2VicGFjazovLy8uL2NvbW1vbi9tZXNzYWdlcy50cyIsIndlYnBhY2s6Ly8vLi9jb21tb24vdXJsLnRzIiwid2VicGFjazovLy8uL2NvbW1vbi9jb25zdGFudHMudHMiLCJ3ZWJwYWNrOi8vLy4vcnVudGltZS9wYW5lbC9tZXNzYWdpbmcvYXBpLnRzIiwid2VicGFjazovLy8uL3J1bnRpbWUvcGFuZWwvbWVzc2FnaW5nL3BvcnRfcnBjLnRzIiwid2VicGFjazovLy8uL2luZnJhL2NkcC9jZHBfY2xpZW50LnRzIiwid2VicGFjazovLy8uL3J1bnRpbWUvcGFuZWwvc3RhdGUvc3RvcmUudHMiLCJ3ZWJwYWNrOi8vLy4vcnVudGltZS9wYW5lbC92aWV3L3N0YXR1cy50cyIsIndlYnBhY2s6Ly8vLi9ydW50aW1lL3BhbmVsL3ZpZXcvdWkudHMiLCJ3ZWJwYWNrOi8vLy4vcnVudGltZS9wYW5lbC9hcHAvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vLy4vaW5mcmEvY2hyb21lL3RhYnMudHMiLCJ3ZWJwYWNrOi8vLy4vcnVudGltZS9wYW5lbC9tZXNzYWdpbmcvY29ubmVjdGlvbi50cyIsIndlYnBhY2s6Ly8vLi9ydW50aW1lL3BhbmVsL3NlcnZpY2VzL2NhcHR1cmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgaTE4biA9IHsgZ2V0LCBsb2NhbGl6ZSB9O1xuLyoqXG4gKiBSZXRyaWV2ZXMgYSBsb2NhbGl6ZWQgbWVzc2FnZSBieSBrZXkuIEZhbGxzIGJhY2sgdG8gdGhlIGtleSBpdHNlbGYgd2hlbiBub3QgZm91bmQuXG4gKlxuICogQHBhcmFtIGtleSAtIEtleSBkZWZpbmVkIGluIF9sb2NhbGVzL21lc3NhZ2VzLmpzb25cbiAqIEBwYXJhbSBzdWJzIC0gT3B0aW9uYWwgc3Vic3RpdHV0aW9uIGFyZ3VtZW50c1xuICogQHJldHVybnMgTG9jYWxpemVkIHN0cmluZ1xuICovXG5mdW5jdGlvbiBnZXQoa2V5LCBzdWJzKSB7XG4gICAgcmV0dXJuIGNocm9tZS5pMThuLmdldE1lc3NhZ2Uoa2V5LCBzdWJzKSB8fCBrZXk7XG59XG4vKipcbiAqIFdhbGtzIHRoZSBET00gYW5kIGFwcGxpZXMgbG9jYWxpemVkIHN0cmluZ3MgdG8gZWxlbWVudHMgd2l0aFxuICogYGRhdGEtaTE4bmAgYW5kIGBkYXRhLWkxOG4tYXR0cmAuXG4gKlxuICogQHBhcmFtIHJvb3QgLSBSb290IG5vZGUgdG8gbG9jYWxpemUgKGRlZmF1bHRzIHRvIGRvY3VtZW50KVxuICogQHJlbWFya3NcbiAqIC0gYGRhdGEtaTE4bmAgcmVwbGFjZXMgYHRleHRDb250ZW50YC5cbiAqIC0gYGRhdGEtaTE4bi1hdHRyYCB1c2VzIGBhdHRyOmtleTthdHRyOmtleTsuLi5gIHRvIHNldCBhdHRyaWJ1dGVzLlxuICogLSBNdXRhdGVzIHRoZSBET00gaW4gcGxhY2UuXG4gKi9cbmZ1bmN0aW9uIGxvY2FsaXplKHJvb3QgPSBkb2N1bWVudCkge1xuICAgIHJvb3QucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtaTE4bl0nKS5mb3JFYWNoKGVsID0+IHtcbiAgICAgICAgY29uc3Qga2V5ID0gZWwuZ2V0QXR0cmlidXRlKCdkYXRhLWkxOG4nKTtcbiAgICAgICAgaWYgKGtleSlcbiAgICAgICAgICAgIGVsLnRleHRDb250ZW50ID0gZ2V0KGtleSk7XG4gICAgfSk7XG4gICAgcm9vdC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1pMThuLWF0dHJdJykuZm9yRWFjaChlbCA9PiB7XG4gICAgICAgIGNvbnN0IHNwZWMgPSBlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaTE4bi1hdHRyJyk7XG4gICAgICAgIGlmICghc3BlYylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgZm9yIChjb25zdCBwYWlyIG9mIHNwZWMuc3BsaXQoJzsnKSkge1xuICAgICAgICAgICAgY29uc3QgW2F0dHIsIGtleV0gPSBwYWlyLnNwbGl0KCc6JykubWFwKHMgPT4gcz8udHJpbSgpKTtcbiAgICAgICAgICAgIGlmIChhdHRyICYmIGtleSlcbiAgICAgICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoYXR0ciwgZ2V0KGtleSkpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnQgZGVmYXVsdCBpMThuO1xuIiwiY29uc3QgUDJDID0ge1xuICAgIFBJTkc6ICdQSU5HJyxcbiAgICBUT0dHTEVfU0VMRUNUOiAnVE9HR0xFX1NFTEVDVCcsXG4gICAgUkVOREVSOiAnUkVOREVSJyxcbiAgICBDTEVBUjogJ0NMRUFSJyxcbiAgICBHRVRfU1RBVEU6ICdHRVRfU1RBVEUnLFxufTtcbmNvbnN0IEMyUCA9IHtcbiAgICBTRUxFQ1RFRDogJ1NFTEVDVEVEJyxcbn07XG5jb25zdCBCMlAgPSB7XG4gICAgQ0xPU0VfUEFORUw6ICdDTE9TRV9QQU5FTCcsXG59O1xuZXhwb3J0IGNvbnN0IE1TR19UWVBFID0geyAuLi5QMkMsIC4uLkMyUCwgLi4uQjJQIH07XG5leHBvcnQgZnVuY3Rpb24gaXNSZXNwb25zZShtc2cpIHtcbiAgICByZXR1cm4gdHlwZW9mIG1zZyA9PT0gJ29iamVjdCcgJiYgbXNnICE9PSBudWxsICYmICdpZCcgaW4gbXNnICYmICdvaycgaW4gbXNnO1xufVxuIiwiLyoqXG4gKiBCdWlsZHMgYSBwYWdlIGtleSBmcm9tIGEgVVJMLiBCeSBkZWZhdWx0IGV4Y2x1ZGVzIHRoZSBoYXNoIGFuZCB1c2VzXG4gKiBvcmlnaW4gKyBwYXRobmFtZSArIHNlYXJjaC5cbiAqXG4gKiBAcGFyYW0gdXJsIC0gSW5wdXQgVVJMIChyZXR1cm5lZCBhcy1pcyBpZiBpbnZhbGlkKVxuICogQHBhcmFtIGluY2x1ZGVIYXNoIC0gV2hldGhlciB0byBpbmNsdWRlIHRoZSBoYXNoIChkZWZhdWx0OiBmYWxzZSlcbiAqIEByZXR1cm5zIFBhZ2Uga2V5IHN0cmluZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gcGFnZUtleSh1cmwsIGluY2x1ZGVIYXNoID0gZmFsc2UpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB1ID0gbmV3IFVSTCh1cmwpO1xuICAgICAgICByZXR1cm4gaW5jbHVkZUhhc2hcbiAgICAgICAgICAgID8gYCR7dS5vcmlnaW59JHt1LnBhdGhuYW1lfSR7dS5zZWFyY2h9JHt1Lmhhc2h9YFxuICAgICAgICAgICAgOiBgJHt1Lm9yaWdpbn0ke3UucGF0aG5hbWV9JHt1LnNlYXJjaH1gO1xuICAgIH1cbiAgICBjYXRjaCB7XG4gICAgICAgIHJldHVybiB1cmw7XG4gICAgfVxufVxuLyoqXG4gKiBDaGVja3MgaWYgYSBVUkwgaXMgcmVzdHJpY3RlZCBvciBzaG91bGQgbm90IGJlIG9wZXJhdGVkIGJ5IHRoZSBleHRlbnNpb24uXG4gKiBFeGFtcGxlczogY2hyb21lOi8vLCBlZGdlOi8vLCBhYm91dDosIG1vei1leHRlbnNpb246Ly9cbiAqXG4gKiBAcGFyYW0gdXJsIC0gVVJMIHRvIGNoZWNrXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBVUkwgaXMgcmVzdHJpY3RlZFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNSZXN0cmljdGVkKHVybCkge1xuICAgIHJldHVybiAhdXJsXG4gICAgICAgIHx8IHVybC5zdGFydHNXaXRoKCdjaHJvbWU6Ly8nKVxuICAgICAgICB8fCB1cmwuc3RhcnRzV2l0aCgnZWRnZTovLycpXG4gICAgICAgIHx8IHVybC5zdGFydHNXaXRoKCdhYm91dDonKVxuICAgICAgICB8fCB1cmwuc3RhcnRzV2l0aCgnbW96LWV4dGVuc2lvbjovLycpO1xufVxuIiwiZXhwb3J0IGNvbnN0IFBST1RPQ09MX1ZFUlNJT04gPSAxO1xuZXhwb3J0IGNvbnN0IENIQU5ORUwgPSB7XG4gICAgUEFORUxfQ09OVEVOVDogYHNwc2s6cGFuZWwtY29udGVudDp2JHtQUk9UT0NPTF9WRVJTSU9OfWAsXG59O1xuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgZ2l2ZW4gUG9ydC5uYW1lIG1hdGNoZXMgdGhlIHNwZWNpZmllZCBjaGFubmVsLlxuICogVXNlIHRoaXMgdG8gc2FmZWx5IGRpc3Rpbmd1aXNoIGNvbm5lY3Rpb24gdHlwZXMgYmV0d2VlbiBQYW5lbCBhbmQgQ29udGVudC5cbiAqXG4gKiBAcGFyYW0gcG9ydCAtIEEgY29ubmVjdGVkIHJ1bnRpbWUuUG9ydFxuICogQHBhcmFtIG5hbWUgLSBUYXJnZXQgY2hhbm5lbCBuYW1lIHRvIGNvbXBhcmVcbiAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHBvcnQgYmVsb25ncyB0byB0aGUgY2hhbm5lbFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNDaGFubmVsKHBvcnQsIG5hbWUpIHtcbiAgICByZXR1cm4gcG9ydC5uYW1lID09PSBuYW1lO1xufVxuLyoqXG4gKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIHBvcnQgaXMgdXNlZCBmb3IgUGFuZWwg4oaUIENvbnRlbnQgY29tbXVuaWNhdGlvbi5cbiAqIEEgY29udmVuaWVuY2Ugd3JhcHBlciBmb3IgQ0hBTk5FTC5QQU5FTF9DT05URU5ULlxuICpcbiAqIEBwYXJhbSBwb3J0IC0gQSBjb25uZWN0ZWQgcnVudGltZS5Qb3J0XG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBwb3J0IGlzIHRoZSBQYW5lbOKAk0NvbnRlbnQgY2hhbm5lbFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNQYW5lbENvbnRlbnRQb3J0KHBvcnQpIHtcbiAgICByZXR1cm4gaXNDaGFubmVsKHBvcnQsIENIQU5ORUwuUEFORUxfQ09OVEVOVCk7XG59XG4iLCJpbXBvcnQgeyBNU0dfVFlQRSB9IGZyb20gJ0Bjb21tb24vbWVzc2FnZXMnO1xuLyoqXG4gKiBUaGluIFJQQyB3cmFwcGVyIGZvciBzZW5kaW5nIG1lc3NhZ2VzIGZyb20gUGFuZWwgdG8gQ29udGVudC5cbiAqIEV4cG9zZXMgaGlnaC1sZXZlbCBtZXRob2RzIGZvciBlYWNoIG1lc3NhZ2UgdHlwZS5cbiAqL1xuZXhwb3J0IGNsYXNzIFBhbmVsQXBpIHtcbiAgICBycGM7XG4gICAgY29uc3RydWN0b3IocnBjKSB7XG4gICAgICAgIHRoaXMucnBjID0gcnBjO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbnRlcm5hbCBzZW5kIGhlbHBlciB0aGF0IGF0dGFjaGVzIGFuIFJQQyByZXF1ZXN0IGlkIGFzIG5lZWRlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBib2R5IC0gTWVzc2FnZSBwYXlsb2FkIHRvIHNlbmRcbiAgICAgKiBAcmV0dXJucyBWb2lkLWxpa2Ugd2hlbiBubyByZXBseSBpcyBleHBlY3RlZDsgb3RoZXJ3aXNlIHJlc29sdmVzIHdpdGggYSByZXNwb25zZVxuICAgICAqL1xuICAgIHNlbmQoYm9keSkge1xuICAgICAgICBjb25zdCByZXEgPSB7XG4gICAgICAgICAgICBpZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgICAgIGV4cGVjdFJlcGx5OiBmYWxzZSxcbiAgICAgICAgICAgIC4uLmJvZHlcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMucnBjLnNlbmQocmVxKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVxdWVzdHMgQ29udGVudCB0byByZW5kZXIgdGhlIGdpdmVuIGl0ZW1zLlxuICAgICAqIEBwYXJhbSBpdGVtcyAtIEl0ZW1zIHRvIGRyYXdcbiAgICAgKi9cbiAgICByZW5kZXIoaXRlbXMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VuZCh7IHR5cGU6IE1TR19UWVBFLlJFTkRFUiwgcGF5bG9hZDogeyBpdGVtcyB9IH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUb2dnbGVzIHNlbGVjdGlvbiBtb2RlIGluIENvbnRlbnQuXG4gICAgICogQHBhcmFtIGVuYWJsZWQgLSBUcnVlIHRvIGVuYWJsZVxuICAgICAqL1xuICAgIHRvZ2dsZVNlbGVjdChlbmFibGVkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbmQoeyB0eXBlOiBNU0dfVFlQRS5UT0dHTEVfU0VMRUNULCBwYXlsb2FkOiB7IGVuYWJsZWQgfSB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYXJzIHRoZSBDb250ZW50IG92ZXJsYXkuXG4gICAgICovXG4gICAgY2xlYXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbmQoeyB0eXBlOiBNU0dfVFlQRS5DTEVBUiB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGVyZm9ybXMgYSBjb25uZWN0aXZpdHkgaGVhbHRoIGNoZWNrIChyb3VuZC10cmlwKS5cbiAgICAgKiBTZW50IGFzIGEgcmVxdWVzdCBleHBlY3RpbmcgYSByZXBseS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFRoZSByZXNwb25zZSwgb3IgdW5kZWZpbmVkIG9uIHRpbWVvdXRcbiAgICAgKi9cbiAgICBwaW5nKCkge1xuICAgICAgICBjb25zdCByZXEgPSB7XG4gICAgICAgICAgICBpZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgICAgIGV4cGVjdFJlcGx5OiB0cnVlLFxuICAgICAgICAgICAgdHlwZTogTVNHX1RZUEUuUElOR1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGhpcy5ycGMuc2VuZChyZXEsIDUwMDApO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IGlzUmVzcG9uc2UgfSBmcm9tICdAY29tbW9uL21lc3NhZ2VzJztcbi8qKlxuICogSW1wbGVtZW50cyBhIG1pbmltYWwgcmVxdWVzdC9yZXNwb25zZSBSUEMgb3ZlciBjaHJvbWUucnVudGltZS5Qb3J0LlxuICogVHJhY2tzIHBlbmRpbmcgcmVxdWVzdHMgYnkgaWQgYW5kIGhhbmRsZXMgdGltZW91dHMgYW5kIGRpc2Nvbm5lY3RzLlxuICovXG5leHBvcnQgY2xhc3MgUG9ydFJwYyB7XG4gICAgcG9ydDtcbiAgICBwZW5kaW5nID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuICAgICAqIFN1YnNjcmliZXMgdG8gcG9ydCBtZXNzYWdlIGFuZCBkaXNjb25uZWN0IGV2ZW50cy5cbiAgICAgKiBAcGFyYW0gcG9ydCAtIFRoZSBydW50aW1lLlBvcnQgdXNlZCBmb3IgbWVzc2FnaW5nXG4gICAgICovXG4gICAgY29uc3RydWN0b3IocG9ydCkge1xuICAgICAgICB0aGlzLnBvcnQgPSBwb3J0O1xuICAgICAgICB0aGlzLnBvcnQub25NZXNzYWdlLmFkZExpc3RlbmVyKChtc2cpID0+IHtcbiAgICAgICAgICAgIGlmIChpc1Jlc3BvbnNlKG1zZykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmcuZ2V0KG1zZy5pZCk/Lihtc2cpO1xuICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZy5kZWxldGUobXNnLmlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucG9ydC5vbkRpc2Nvbm5lY3QuYWRkTGlzdGVuZXIoKCkgPT4ge1xuICAgICAgICAgICAgLy8gVHJlYXQgcGVuZGluZyBzdGF0dXMgYXMgZmFpbHVyZSB3aGVuIGEgZGlzY29ubmVjdGlvbiBvY2N1cnMuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IFssIHJlc29sdmVdIG9mIHRoaXMucGVuZGluZylcbiAgICAgICAgICAgICAgICByZXNvbHZlKHsgaWQ6ICcnLCBvazogZmFsc2UsIGVycm9yOiAnZGlzY29ubmVjdGVkJyB9KTtcbiAgICAgICAgICAgIHRoaXMucGVuZGluZy5jbGVhcigpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2VuZHMgYW4gUlBDIHJlcXVlc3QgYW5kIG9wdGlvbmFsbHkgYXdhaXRzIGEgcmVzcG9uc2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcmVxIC0gVGhlIFJQQyByZXF1ZXN0IHRvIHNlbmRcbiAgICAgKiBAcGFyYW0gdGltZW91dE1zIC0gVGltZW91dCAobXMpIHdoZW4gd2FpdGluZyBmb3IgYSByZXBseSAoZGVmYXVsdCA1MDAwKVxuICAgICAqIEByZXR1cm5zIFRoZSByZXNwb25zZSB3aGVuIGBleHBlY3RSZXBseWAgaXMgdHJ1ZTsgb3RoZXJ3aXNlIHVuZGVmaW5lZFxuICAgICAqL1xuICAgIHNlbmQocmVxLCB0aW1lb3V0TXMgPSA1MDAwKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlcS5leHBlY3RSZXBseSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZy5kZWxldGUocmVxLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgIH0sIHRpbWVvdXRNcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nLnNldChyZXEuaWQsIChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcnQucG9zdE1lc3NhZ2UocmVxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIHtcbiAgICAgICAgICAgICAgICBpZiAocmVxLmV4cGVjdFJlcGx5KVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmcuZGVsZXRlKHJlcS5pZCk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghcmVxLmV4cGVjdFJlcGx5KVxuICAgICAgICAgICAgICAgIHJlc29sdmUodW5kZWZpbmVkKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIiwiZXhwb3J0IGNvbnN0IENEUF9WRVJTSU9OID0gJzEuMyc7XG4vKipcbiAqIFdyYXBzIGBjaHJvbWUucnVudGltZS5sYXN0RXJyb3JgIGludG8gYSBzdGFuZGFyZCBgRXJyb3JgIGluc3RhbmNlLlxuICpcbiAqIEByZXR1cm5zIEFuIGBFcnJvcmAgd2hlbiBhIGxhc3RFcnJvciBleGlzdHM7IG90aGVyd2lzZSBgbnVsbGAuXG4gKi9cbmZ1bmN0aW9uIGxhc3RFcnJvcigpIHtcbiAgICBjb25zdCBlcnIgPSBjaHJvbWUucnVudGltZS5sYXN0RXJyb3I7XG4gICAgcmV0dXJuIGVyciA/IG5ldyBFcnJvcihlcnIubWVzc2FnZSB8fCBTdHJpbmcoZXJyKSkgOiBudWxsO1xufVxuLyoqXG4gKiBBdHRhY2hlcyB0aGUgQ2hyb21lIERlYnVnZ2VyIChDRFApIHRvIHRoZSBnaXZlbiB0YXJnZXQuXG4gKlxuICogQHBhcmFtIHRhcmdldCAtIFRoZSBkZWJ1Z2dlZSAoZS5nLiwgYHsgdGFiSWQgfWApIHRvIGF0dGFjaCB0by5cbiAqIEByZXR1cm5zIEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGRlYnVnZ2VyIGlzIGF0dGFjaGVkLCBvciByZWplY3RzIG9uIGVycm9yLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXR0YWNoKHRhcmdldCkge1xuICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY2hyb21lLmRlYnVnZ2VyLmF0dGFjaCh0YXJnZXQsIENEUF9WRVJTSU9OLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnIgPSBsYXN0RXJyb3IoKTtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG4vKipcbiAqIERldGFjaGVzIHRoZSBDaHJvbWUgRGVidWdnZXIgKENEUCkgZnJvbSB0aGUgZ2l2ZW4gdGFyZ2V0LlxuICpcbiAqIEBwYXJhbSB0YXJnZXQgLSBUaGUgZGVidWdnZWUgdG8gZGV0YWNoIGZyb20uXG4gKiBAcmV0dXJucyBBIHByb21pc2UgdGhhdCByZXNvbHZlcyBvbmNlIGRldGFjaG1lbnQgY29tcGxldGVzLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGV0YWNoKHRhcmdldCkge1xuICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgIGNocm9tZS5kZWJ1Z2dlci5kZXRhY2godGFyZ2V0LCAoKSA9PiByZXNvbHZlKCkpO1xuICAgIH0pO1xufVxuLyoqXG4gKiBTZW5kcyBhIENEUCBjb21tYW5kIHRvIHRoZSBhdHRhY2hlZCB0YXJnZXQuXG4gKlxuICogQHR5cGVQYXJhbSBUIC0gRXhwZWN0ZWQgcmVzdWx0IHR5cGUgb2YgdGhlIGNvbW1hbmQuXG4gKiBAcGFyYW0gdGFyZ2V0IC0gVGhlIGRlYnVnZ2VlIHRvIHdoaWNoIHRoZSBjb21tYW5kIGlzIHNlbnQuXG4gKiBAcGFyYW0gbWV0aG9kIC0gQ0RQIG1ldGhvZCBuYW1lIChlLmcuLCBgJ1BhZ2UuY2FwdHVyZVNjcmVlbnNob3QnYCkuXG4gKiBAcGFyYW0gcGFyYW1zIC0gT3B0aW9uYWwgcGFyYW1ldGVycyBvYmplY3QgZm9yIHRoZSBjb21tYW5kLlxuICogQHJldHVybnMgQSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgY29tbWFuZCByZXN1bHQgb3IgcmVqZWN0cyBpZiBhbiBlcnJvciBvY2N1cnMuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kKHRhcmdldCwgbWV0aG9kLCBwYXJhbXMpIHtcbiAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjaHJvbWUuZGVidWdnZXIuc2VuZENvbW1hbmQodGFyZ2V0LCBtZXRob2QsIHBhcmFtcyA/PyB7fSwgKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyID0gbGFzdEVycm9yKCk7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKChyZXN1bHQgPz8ge30pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG4iLCJjb25zdCBST09UX0tFWSA9ICdzY3JlZW5TdGF0ZUJ5UGFnZSc7XG4vKipcbiAqIExvYWRzIHRoZSBlbnRpcmUgc3RhdGUgbWFwIGZyb20gY2hyb21lLnN0b3JhZ2UubG9jYWwgdW5kZXIgUk9PVF9LRVkuXG4gKlxuICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gdGhlIGZ1bGwgc3RhdGUgbWFwOyByZXR1cm5zIGFuIGVtcHR5IG9iamVjdCB3aGVuIG5vdGhpbmcgaXMgc3RvcmVkLlxuICogQHJlbWFya3MgVGhpcyBwZXJmb3JtcyBzdG9yYWdlIEkvTy5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVhZEFsbCgpIHtcbiAgICBjb25zdCByYXcgPSBhd2FpdCBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQoUk9PVF9LRVkpO1xuICAgIHJldHVybiByYXdbUk9PVF9LRVldID8/IHt9O1xufVxuLyoqXG4gKiBQZXJzaXN0cyB0aGUgZW50aXJlIHN0YXRlIG1hcCB0byBjaHJvbWUuc3RvcmFnZS5sb2NhbCB1bmRlciBST09UX0tFWS5cbiAqXG4gKiBAcGFyYW0gbWFwIC0gVGhlIGNvbXBsZXRlIHN0YXRlIG1hcCB0byB3cml0ZS5cbiAqIEByZXR1cm5zIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSB3cml0ZSBjb21wbGV0ZXMuXG4gKiBAcmVtYXJrcyBUaGlzIG92ZXJ3cml0ZXMgdGhlIHN0b3JlZCBtYXAgZm9yIFJPT1RfS0VZLlxuICovXG5hc3luYyBmdW5jdGlvbiB3cml0ZUFsbChtYXApIHtcbiAgICBhd2FpdCBjaHJvbWUuc3RvcmFnZS5sb2NhbC5zZXQoeyBbUk9PVF9LRVldOiBtYXAgfSk7XG59XG4vKipcbiAqIFJldHJpZXZlcyB0aGUgc3RhdGUgYm91bmQgdG8gYSBwYWdlIGtleS5cbiAqIFJldHVybnMgdGhlIGluaXRpYWwgZGVmYXVsdCB3aGVuIHRoZSBrZXkgaGFzIG5vIHN0b3JlZCBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0gcGFnZUtleSAtIFBhZ2Uga2V5IHRoYXQgaWRlbnRpZmllcyB0aGUgcGFnZSBzdGF0ZSBidWNrZXQuXG4gKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byB0aGUgY29ycmVzcG9uZGluZyBTY3JlZW5TdGF0ZS5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFN0YXRlKHBhZ2VLZXkpIHtcbiAgICBjb25zdCBtYXAgPSBhd2FpdCByZWFkQWxsKCk7XG4gICAgcmV0dXJuIG1hcFtwYWdlS2V5XSA/PyB7IGl0ZW1zOiBbXSwgbmV4dElkOiAxLCBuZXh0TGFiZWw6IDEgfTtcbn1cbi8qKlxuICogU3RvcmVzIHRoZSBnaXZlbiBzdGF0ZSB1bmRlciB0aGUgc3BlY2lmaWVkIHBhZ2Uga2V5LlxuICpcbiAqIEBwYXJhbSBwYWdlS2V5U3RyIC0gUGFnZSBrZXkgdG8gYXNzb2NpYXRlIHdpdGggdGhlIHN0YXRlLlxuICogQHBhcmFtIHN0YXRlIC0gVGhlIFNjcmVlblN0YXRlIHRvIHBlcnNpc3QuXG4gKiBAcmV0dXJucyBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgd3JpdGUgY29tcGxldGVzLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0U3RhdGUocGFnZUtleVN0ciwgc3RhdGUpIHtcbiAgICBjb25zdCBtYXAgPSBhd2FpdCByZWFkQWxsKCk7XG4gICAgbWFwW3BhZ2VLZXlTdHJdID0gc3RhdGU7XG4gICAgYXdhaXQgd3JpdGVBbGwobWFwKTtcbn1cbi8qKlxuICogUmVhc3NpZ25zIGxhYmVscyBzZXF1ZW50aWFsbHkgKDEuLm4pIGFjY29yZGluZyB0byB0aGUgY3VycmVudCBhcnJheSBvcmRlci5cbiAqXG4gKiBAcGFyYW0gc3RhdGUgLSBUaGUgc3RhdGUgd2hvc2UgaXRlbXMgc2hvdWxkIGJlIHJlbGFiZWxlZCBpbi1wbGFjZS5cbiAqIEByZW1hcmtzIEFsc28gdXBkYXRlcyBgbmV4dExhYmVsYCB0byBgaXRlbXMubGVuZ3RoICsgMWAuXG4gKi9cbmZ1bmN0aW9uIHJlbGFiZWxTZXF1ZW50aWFsKHN0YXRlKSB7XG4gICAgc3RhdGUuaXRlbXMuZm9yRWFjaCgoaXQsIGkpID0+IHtcbiAgICAgICAgaXQubGFiZWwgPSBpICsgMTtcbiAgICB9KTtcbiAgICBzdGF0ZS5uZXh0TGFiZWwgPSBzdGF0ZS5pdGVtcy5sZW5ndGggKyAxO1xufVxuLyoqXG4gKiBBcHBsaWVzIGEgcGF0Y2ggKGFkZC91cGRhdGUvcmVtb3ZlKSB0byB0aGUgc3RhdGUgZm9yIHRoZSBnaXZlbiBwYWdlIGtleSxcbiAqIHJlbGFiZWxzIHNlcXVlbnRpYWxseSBpZiBhbnkgcmVtb3ZhbCBvY2N1cnJlZCwgcGVyc2lzdHMgdGhlIHJlc3VsdCxcbiAqIGFuZCByZXR1cm5zIHRoZSB1cGRhdGVkIHN0YXRlLlxuICpcbiAqIEBwYXJhbSBwYWdlS2V5U3RyIC0gUGFnZSBrZXkgb2YgdGhlIHN0YXRlIHRvIG1vZGlmeS5cbiAqIEBwYXJhbSBwYXRjaCAtIENoYW5nZXMgdG8gYXBwbHkgdG8gdGhlIHN0YXRlLlxuICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gdGhlIHVwZGF0ZWQgU2NyZWVuU3RhdGUuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhcHBseVBhdGNoKHBhZ2VLZXlTdHIsIHBhdGNoKSB7XG4gICAgY29uc3Qgc3RhdGUgPSBhd2FpdCBnZXRTdGF0ZShwYWdlS2V5U3RyKTtcbiAgICBjb25zdCBoYXNSZW1vdmFsID0gISEocGF0Y2gucmVtb3ZlZElkcyAmJiBwYXRjaC5yZW1vdmVkSWRzLmxlbmd0aCk7XG4gICAgaWYgKHBhdGNoLnJlbW92ZWRJZHM/Lmxlbmd0aCkge1xuICAgICAgICBjb25zdCB0b1JlbW92ZSA9IG5ldyBTZXQocGF0Y2gucmVtb3ZlZElkcyk7XG4gICAgICAgIHN0YXRlLml0ZW1zID0gc3RhdGUuaXRlbXMuZmlsdGVyKChpdCkgPT4gIXRvUmVtb3ZlLmhhcyhpdC5pZCkpO1xuICAgIH1cbiAgICBpZiAocGF0Y2gudXBkYXRlZD8ubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoc3RhdGUuaXRlbXMubWFwKChpKSA9PiBbaS5pZCwgaV0pKTtcbiAgICAgICAgZm9yIChjb25zdCB1IG9mIHBhdGNoLnVwZGF0ZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGl0ID0gbWFwLmdldCh1LmlkKTtcbiAgICAgICAgICAgIGlmICghaXQpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHUubGFiZWwgPT09ICdudW1iZXInKVxuICAgICAgICAgICAgICAgIGl0LmxhYmVsID0gdS5sYWJlbDtcbiAgICAgICAgICAgIGlmICh1LmFuY2hvcilcbiAgICAgICAgICAgICAgICBpdC5hbmNob3IgPSB1LmFuY2hvcjtcbiAgICAgICAgICAgIGlmICh1Lm1ldGEpXG4gICAgICAgICAgICAgICAgaXQubWV0YSA9IHUubWV0YTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAocGF0Y2guYWRkZWQ/Lmxlbmd0aCkge1xuICAgICAgICBmb3IgKGNvbnN0IGEgb2YgcGF0Y2guYWRkZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGlkID0gc3RhdGUubmV4dElkKys7XG4gICAgICAgICAgICBjb25zdCBsYWJlbCA9IHR5cGVvZiBhLmxhYmVsID09PSAnbnVtYmVyJyA/IGEubGFiZWwgOiBzdGF0ZS5uZXh0TGFiZWwrKztcbiAgICAgICAgICAgIGNvbnN0IGl0ID0ge1xuICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICAgIGxhYmVsLFxuICAgICAgICAgICAgICAgIGFuY2hvcjogYS5hbmNob3IsXG4gICAgICAgICAgICAgICAgLi4uKGEubWV0YSA/IHsgbWV0YTogYS5tZXRhIH0gOiB7fSksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc3RhdGUuaXRlbXMucHVzaChpdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gSWYgYXQgbGVhc3Qgb25lIGl0ZW0gaXMgZGVsZXRlZCwgcmVsYWJlbCBmcm9tIDEgdG8gbiBpbiB0aGUgY3VycmVudCBhcnJheSBvcmRlci5cbiAgICBpZiAoaGFzUmVtb3ZhbCkge1xuICAgICAgICByZWxhYmVsU2VxdWVudGlhbChzdGF0ZSk7XG4gICAgfVxuICAgIGF3YWl0IHNldFN0YXRlKHBhZ2VLZXlTdHIsIHN0YXRlKTtcbiAgICByZXR1cm4gc3RhdGU7XG59XG4vKipcbiAqIFRvZ2dsZXMgc2VsZWN0aW9uIGZvciB0aGUgZ2l2ZW4gYW5jaG9ycyAoZnJvbSBDb250ZW50KTogaWYgYW4gYW5jaG9yIGFscmVhZHlcbiAqIGV4aXN0cywgcmVtb3ZlIGl0OyBvdGhlcndpc2UgYWRkIGl0LiBEZWR1cGUgaW5jb21pbmcgYW5jaG9ycyBieSBgdmFsdWVgLFxuICogYXBwbHkgdGhlIGNvcnJlc3BvbmRpbmcgcGF0Y2gsIHBlcnNpc3QsIGFuZCByZXR1cm4gdGhlIGxhdGVzdCBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0gcGFnZUtleVN0ciAtIFBhZ2Uga2V5IG9mIHRoZSBzdGF0ZSB0byB1cGRhdGUuXG4gKiBAcGFyYW0gYW5jaG9ycyAtIEFuY2hvcnMgcmVwb3J0ZWQgYnkgQ29udGVudC5cbiAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIHRoZSB1cGRhdGVkIFNjcmVlblN0YXRlLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlU2VsZWN0ZWQocGFnZUtleVN0ciwgYW5jaG9ycykge1xuICAgIGNvbnN0IHN0YXRlID0gYXdhaXQgZ2V0U3RhdGUocGFnZUtleVN0cik7XG4gICAgY29uc3QgdW5pcSA9IEFycmF5LmZyb20obmV3IFNldChhbmNob3JzLm1hcCgoYSkgPT4gYS52YWx1ZSkpKVxuICAgICAgICAubWFwKCh2KSA9PiBhbmNob3JzLmZpbmQoKGEpID0+IGEudmFsdWUgPT09IHYpKVxuICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgIGNvbnN0IHJlbW92ZWRJZHMgPSBbXTtcbiAgICBjb25zdCB0b0FkZCA9IFtdO1xuICAgIGZvciAoY29uc3QgYSBvZiB1bmlxKSB7XG4gICAgICAgIGNvbnN0IGZvdW5kID0gc3RhdGUuaXRlbXMuZmluZCgoaXQpID0+IGl0LmFuY2hvci5raW5kID09PSBhLmtpbmQgJiYgaXQuYW5jaG9yLnZhbHVlID09PSBhLnZhbHVlKTtcbiAgICAgICAgaWYgKGZvdW5kKSB7XG4gICAgICAgICAgICByZW1vdmVkSWRzLnB1c2goZm91bmQuaWQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdG9BZGQucHVzaCh7IGFuY2hvcjogYSB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBwYXRjaCA9IHt9O1xuICAgIGlmIChyZW1vdmVkSWRzLmxlbmd0aClcbiAgICAgICAgcGF0Y2gucmVtb3ZlZElkcyA9IHJlbW92ZWRJZHM7XG4gICAgaWYgKHRvQWRkLmxlbmd0aClcbiAgICAgICAgcGF0Y2guYWRkZWQgPSB0b0FkZDtcbiAgICByZXR1cm4gYXBwbHlQYXRjaChwYWdlS2V5U3RyLCBwYXRjaCk7XG59XG4iLCJpbXBvcnQgaTE4biBmcm9tICdAY29tbW9uL2kxOG4nO1xuZXhwb3J0IGNvbnN0IFNUQVRVUyA9IHtcbiAgICBSRVNUUklDVEVEOiAnUkVTVFJJQ1RFRCcsXG4gICAgQ09OTkVDVElORzogJ0NPTk5FQ1RJTkcnLFxuICAgIENPTk5FQ1RFRDogJ0NPTk5FQ1RFRCcsXG4gICAgRElTQ09OTkVDVEVEOiAnRElTQ09OTkVDVEVEJyxcbn07XG5jb25zdCBTVEFUVVNfTVNHX0tFWSA9IHtcbiAgICBSRVNUUklDVEVEOiAnc3RhdHVzX3Jlc3RyaWN0ZWQnLFxuICAgIENPTk5FQ1RJTkc6ICdzdGF0dXNfY29ubmVjdGluZycsXG4gICAgQ09OTkVDVEVEOiAnc3RhdHVzX2Nvbm5lY3RlZCcsXG4gICAgRElTQ09OTkVDVEVEOiAnc3RhdHVzX2Rpc2Nvbm5lY3RlZCcsXG59O1xuZXhwb3J0IGNvbnN0IFNUQVRVU19MQUJFTF9TVFlMRSA9IHtcbiAgICBSRVNUUklDVEVEOiB7XG4gICAgICAgIGJvZHk6IFtcbiAgICAgICAgICAgICdiZy1hbWJlci01MCcsICdib3JkZXItYW1iZXItMjAwJywgJ3RleHQtYW1iZXItNzAwJyxcbiAgICAgICAgICAgICdkYXJrOmJnLWFtYmVyLTk1MCcsICdkYXJrOmJvcmRlci1hbWJlci05MDAvNTAnLCAnZGFyazp0ZXh0LWFtYmVyLTMwMCcsXG4gICAgICAgIF0sXG4gICAgICAgIGRvdDogWydiZy1hbWJlci01MDAnXVxuICAgIH0sXG4gICAgQ09OTkVDVElORzoge1xuICAgICAgICBib2R5OiBbXG4gICAgICAgICAgICAnYmctc2t5LTUwJywgJ2JvcmRlci1za3ktMjAwJywgJ3RleHQtc2t5LTcwMCcsXG4gICAgICAgICAgICAnZGFyazpiZy1za3ktOTUwJywgJ2Rhcms6Ym9yZGVyLXNreS05MDAvNTAnLCAnZGFyazp0ZXh0LXNreS0zMDAnLFxuICAgICAgICBdLFxuICAgICAgICBkb3Q6IFsnYmctc2t5LTUwMCddXG4gICAgfSxcbiAgICBDT05ORUNURUQ6IHtcbiAgICAgICAgYm9keTogW1xuICAgICAgICAgICAgJ2JnLWVtZXJhbGQtNTAnLCAnYm9yZGVyLWVtZXJhbGQtMjAwJywgJ3RleHQtZW1lcmFsZC03MDAnLFxuICAgICAgICAgICAgJ2Rhcms6YmctZW1lcmFsZC05NTAnLCAnZGFyazpib3JkZXItZW1lcmFsZC05MDAvNTAnLCAnZGFyazp0ZXh0LWVtZXJhbGQtMzAwJyxcbiAgICAgICAgXSxcbiAgICAgICAgZG90OiBbJ2JnLWVtZXJhbGQtNTAwJ11cbiAgICB9LFxuICAgIERJU0NPTk5FQ1RFRDoge1xuICAgICAgICBib2R5OiBbXG4gICAgICAgICAgICAnYmctcm9zZS01MCcsICdib3JkZXItcm9zZS0yMDAnLCAndGV4dC1yb3NlLTcwMCcsXG4gICAgICAgICAgICAnZGFyazpiZy1yb3NlLTk1MCcsICdkYXJrOmJvcmRlci1yb3NlLTkwMC81MCcsICdkYXJrOnRleHQtcm9zZS0zMDAnLFxuICAgICAgICBdLFxuICAgICAgICBkb3Q6IFsnYmctcm9zZS01MDAnXVxuICAgIH0sXG59O1xuZXhwb3J0IGZ1bmN0aW9uIGdldFN0YXR1c01lc3NhZ2Uoa2V5KSB7XG4gICAgY29uc3QgbXNnS2V5ID0gU1RBVFVTX01TR19LRVlba2V5XTtcbiAgICByZXR1cm4gaTE4bi5nZXQobXNnS2V5KSB8fCBtc2dLZXk7XG59XG4iLCJpbXBvcnQgaTE4biBmcm9tICdAY29tbW9uL2kxOG4nO1xuaW1wb3J0IHsgZ2V0U3RhdHVzTWVzc2FnZSwgU1RBVFVTLCBTVEFUVVNfTEFCRUxfU1RZTEUgfSBmcm9tICdAcGFuZWwvdmlldy9zdGF0dXMnO1xuY29uc3Qgc3RhdHVzRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdHVzJyk7XG5jb25zdCB0b2dnbGVJY29uRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlLXNlbGVjdC1pY29uJyk7XG5jb25zdCB0b2dnbGVMYWJlbEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZ2dsZS1zZWxlY3QtbGFiZWwnKTtcbmNvbnN0IHNlbGVjdENvdW50RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0LWNvdW50Jyk7XG5jb25zdCBzZWxlY3RFbXB0eUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdC1lbXB0eScpO1xuY29uc3Qgc2VsZWN0TGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdC1saXN0Jyk7XG5jb25zdCBTVEFUVVNfQkFTRV9CT0RZID0gW1xuICAgICdpbmxpbmUtZmxleCcsICdpdGVtcy1jZW50ZXInLCAnZ2FwLTEnLFxuICAgICdyb3VuZGVkLWZ1bGwnLCAnYm9yZGVyJywgJ3B4LTInLCAncHktMScsICd0ZXh0LXhzJyxcbiAgICAndHJhbnNpdGlvbi1jb2xvcnMnLFxuXTtcbmNvbnN0IFRPR0dMRV9JQ09OX0JBU0UgPSBbXG4gICAgJ2lubGluZS1ibG9jaycsICd3LTMnLCAnaC0zJywgJ3JvdW5kZWQtZnVsbCcsXG5dO1xuY29uc3QgVE9HR0xFX0lDT05fT04gPSBbJ2JnLWVtZXJhbGQtNTAwJ107XG5jb25zdCBUT0dHTEVfSUNPTl9PRkYgPSBbJ2JnLXNsYXRlLTMwMCddO1xuZnVuY3Rpb24gZGlzYWJsZWRCdG5zKGlzRGlzYWJsZWQpIHtcbiAgICBjb25zdCBidG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJyk7XG4gICAgYnRucy5mb3JFYWNoKGJ0biA9PiBidG4uZGlzYWJsZWQgPSBpc0Rpc2FibGVkKTtcbn1cbi8qKlxuICogVXBkYXRlcyB0aGUgY29ubmVjdGlvbiBzdGF0dXMgaW5kaWNhdG9yJ3Mgc3R5bGUgYW5kIHRleHQuXG4gKlxuICogQHBhcmFtIGtleSAtIEN1cnJlbnQgc3RhdHVzIGtleVxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlU3RhdHVzVUkoa2V5KSB7XG4gICAgY29uc3Qgc3R5bGUgPSBTVEFUVVNfTEFCRUxfU1RZTEVba2V5XTtcbiAgICBzdGF0dXNFbC5jbGFzc05hbWUgPSAnJztcbiAgICBzdGF0dXNFbC5jbGFzc0xpc3QuYWRkKC4uLlNUQVRVU19CQVNFX0JPRFksIC4uLnN0eWxlLmJvZHkpO1xuICAgIGNvbnN0IGRvdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICBkb3QuY2xhc3NMaXN0LmFkZCgnaC0xLjUnLCAndy0xLjUnLCAncm91bmRlZC1mdWxsJywgLi4uc3R5bGUuZG90KTtcbiAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgIHRleHQudGV4dENvbnRlbnQgPSBnZXRTdGF0dXNNZXNzYWdlKGtleSk7XG4gICAgc3RhdHVzRWwucmVwbGFjZUNoaWxkcmVuKGRvdCwgdGV4dCk7XG4gICAgZGlzYWJsZWRCdG5zKGtleSAhPT0gU1RBVFVTLkNPTk5FQ1RFRCk7XG59XG4vKipcbiAqIFVwZGF0ZXMgdGhlIHNlbGVjdGlvbiB0b2dnbGUncyBpY29uIGFuZCBsYWJlbC5cbiAqXG4gKiBAcGFyYW0gZW5hYmxlZCAtIFRydWUgaWYgc2VsZWN0aW9uIGlzIGVuYWJsZWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVRvZ2dsZUljb25VSShlbmFibGVkKSB7XG4gICAgdG9nZ2xlSWNvbkVsLmNsYXNzTmFtZSA9ICcnO1xuICAgIHRvZ2dsZUljb25FbC5jbGFzc0xpc3QuYWRkKC4uLlRPR0dMRV9JQ09OX0JBU0UsIC4uLihlbmFibGVkID8gVE9HR0xFX0lDT05fT04gOiBUT0dHTEVfSUNPTl9PRkYpKTtcbiAgICB0b2dnbGVMYWJlbEVsLnRleHRDb250ZW50ID0gaTE4bi5nZXQoZW5hYmxlZCA/ICd0b2dnbGVfb24nIDogJ3RvZ2dsZV9vZmYnKTtcbn1cbi8qKlxuICogUmVidWlsZHMgdGhlIHNlbGVjdGlvbiBsaXN0IFVJLiBTaG93cyBhbiBlbXB0eSBzdGF0ZSB3aGVuIG5vIGl0ZW1zIGV4aXN0LlxuICpcbiAqIEBwYXJhbSBpdGVtcyAtIEl0ZW1zIHRvIGRpc3BsYXlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlckxpc3QoaXRlbXMpIHtcbiAgICBjb25zdCBpc0VtcHR5ID0gaXRlbXMubGVuZ3RoID09PSAwO1xuICAgIHNlbGVjdENvdW50RWwudGV4dENvbnRlbnQgPSBTdHJpbmcoaXRlbXMubGVuZ3RoKTtcbiAgICBpZiAoaXNFbXB0eSkge1xuICAgICAgICBzZWxlY3RFbXB0eUVsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuICAgICAgICBzZWxlY3RMaXN0RWwucmVwbGFjZUNoaWxkcmVuKCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2VsZWN0RW1wdHlFbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcbiAgICBjb25zdCBmcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIGZvciAoY29uc3QgaXQgb2YgaXRlbXMpIHtcbiAgICAgICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICAgICAgICBsaS5jbGFzc05hbWUgPSAnZ3JvdXAgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTMgcC0zIGhvdmVyOmJnLXNsYXRlLTUwIGRhcms6aG92ZXI6Ymctc2xhdGUtODAwLzYwJztcbiAgICAgICAgbGkuZGF0YXNldC5pZCA9IFN0cmluZyhpdC5pZCk7XG4gICAgICAgIGNvbnN0IGJhZGdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICBiYWRnZS5jbGFzc05hbWUgPSAnaW5saW5lLWZsZXggaC02IHctNiBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcm91bmRlZC1tZCBiZy1pbmRpZ28tNjAwLzEwIHRleHQtaW5kaWdvLTcwMCBkYXJrOnRleHQtaW5kaWdvLTMwMCB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQnO1xuICAgICAgICBiYWRnZS50ZXh0Q29udGVudCA9IFN0cmluZyhpdC5sYWJlbCk7XG4gICAgICAgIGNvbnN0IG1haW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgbWFpbi5jbGFzc05hbWUgPSAnbWluLXctMCBmbGV4LTEnO1xuICAgICAgICBjb25zdCBsaW5lMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBsaW5lMS5jbGFzc05hbWUgPSAndGV4dC1zbSBmb250LW1lZGl1bSB0cnVuY2F0ZSc7XG4gICAgICAgIGxpbmUxLnRleHRDb250ZW50ID0gaXQuYW5jaG9yLnZhbHVlO1xuICAgICAgICBtYWluLmFwcGVuZChsaW5lMSk7XG4gICAgICAgIGxpLmFwcGVuZChiYWRnZSwgbWFpbik7XG4gICAgICAgIGZyYWcuYXBwZW5kQ2hpbGQobGkpO1xuICAgIH1cbiAgICBzZWxlY3RMaXN0RWwucmVwbGFjZUNoaWxkcmVuKGZyYWcpO1xufVxuIiwiaW1wb3J0IGkxOG4gZnJvbSAnQGNvbW1vbi9pMThuJztcbmltcG9ydCB7IE1TR19UWVBFIH0gZnJvbSAnQGNvbW1vbi9tZXNzYWdlcyc7XG5pbXBvcnQgeyBpc1Jlc3RyaWN0ZWQsIHBhZ2VLZXkgfSBmcm9tICdAY29tbW9uL3VybCc7XG5pbXBvcnQgeyBnZXRBY3RpdmVUYWIgfSBmcm9tICdAaW5mcmEvY2hyb21lL3RhYnMnO1xuaW1wb3J0IHsgY29ubmVjdFRvVGFiIH0gZnJvbSAnQHBhbmVsL21lc3NhZ2luZy9jb25uZWN0aW9uJztcbmltcG9ydCB7IGNhcHR1cmVGdWxsUGFnZSB9IGZyb20gJ0BwYW5lbC9zZXJ2aWNlcy9jYXB0dXJlJztcbmltcG9ydCB7IGdldFN0YXRlLCBoYW5kbGVTZWxlY3RlZCwgc2V0U3RhdGUgfSBmcm9tICdAcGFuZWwvc3RhdGUvc3RvcmUnO1xuaW1wb3J0IHsgU1RBVFVTIH0gZnJvbSAnQHBhbmVsL3ZpZXcvc3RhdHVzJztcbmltcG9ydCB7IHJlbmRlckxpc3QsIHVwZGF0ZVN0YXR1c1VJLCB1cGRhdGVUb2dnbGVJY29uVUkgfSBmcm9tICdAcGFuZWwvdmlldy91aSc7XG5jb25zdCB0b2dnbGVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlLXNlbGVjdCcpO1xuY29uc3QgY2xlYXJCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXInKTtcbmNvbnN0IGNhcHR1cmVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FwdHVyZScpO1xubGV0IGN1cnJlbnRUYWJJZCA9IG51bGw7XG5sZXQgY3VycmVudFBhZ2VLZXkgPSAnJztcbmxldCBzZWxlY3Rpb25FbmFibGVkID0gZmFsc2U7XG5tYWluKCkuY2F0Y2goY29uc29sZS5lcnJvcik7XG4vKipcbiAqIE9yY2hlc3RyYXRlcyBVSSBpbml0aWFsaXphdGlvbiBhbmQgY29ubmVjdGlvbiBsaWZlY3ljbGUuXG4gKiAtIEFwcGx5IGkxOG5cbiAqIC0gRGV0ZWN0IGFuZCBjb25uZWN0IHRvIHRoZSBhY3RpdmUgdGFiXG4gKiAtIFJlc3RvcmUgc3RhdGUgYW5kIHBlcmZvcm0gaW5pdGlhbCByZW5kZXJcbiAqIC0gQmluZCBVSSBldmVudHNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gbWFpbigpIHtcbiAgICBpMThuLmxvY2FsaXplKGRvY3VtZW50KTtcbiAgICBjb25zdCB0YWIgPSBhd2FpdCBnZXRBY3RpdmVUYWIoKTtcbiAgICBpZiAoIXRhYj8uaWQgfHwgaXNSZXN0cmljdGVkKHRhYi51cmwpKVxuICAgICAgICByZXR1cm4gdXBkYXRlU3RhdHVzVUkoU1RBVFVTLlJFU1RSSUNURUQpO1xuICAgIGN1cnJlbnRUYWJJZCA9IHRhYi5pZDtcbiAgICBjdXJyZW50UGFnZUtleSA9IHBhZ2VLZXkodGFiLnVybCk7XG4gICAgdXBkYXRlU3RhdHVzVUkoU1RBVFVTLkNPTk5FQ1RJTkcpO1xuICAgIGNvbnN0IGNvbm4gPSBhd2FpdCBjb25uZWN0VG9UYWIoY3VycmVudFRhYklkKTtcbiAgICBjb25uLm9uRGlzY29ubmVjdCgoKSA9PiB7XG4gICAgICAgIHVwZGF0ZVN0YXR1c1VJKFNUQVRVUy5ESVNDT05ORUNURUQpO1xuICAgICAgICBzZWxlY3Rpb25FbmFibGVkID0gZmFsc2U7XG4gICAgICAgIHVwZGF0ZVRvZ2dsZUljb25VSShzZWxlY3Rpb25FbmFibGVkKTtcbiAgICB9KTtcbiAgICAvLyBSZWNlaXZlcyBtZXNzYWdlcyBmcm9tIENvbnRlbnQg4oaSIFBhbmVsLlxuICAgIC8vIEFwcGxpZXMgc2VsZWN0aW9uIHJlc3VsdHMgKGFuY2hvcnMpLCB1cGRhdGVzIHN0YXRlLCBhbmQgcmUtcmVuZGVycy5cbiAgICBjb25uLnBvcnQub25NZXNzYWdlLmFkZExpc3RlbmVyKGFzeW5jIChtc2cpID0+IHtcbiAgICAgICAgaWYgKCFtc2cgfHwgIW1zZy50eXBlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAobXNnLnR5cGUgPT09IE1TR19UWVBFLlNFTEVDVEVEKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdTdGF0ZSA9IGF3YWl0IGhhbmRsZVNlbGVjdGVkKGN1cnJlbnRQYWdlS2V5LCBtc2cucGF5bG9hZC5hbmNob3JzKTtcbiAgICAgICAgICAgIHJlbmRlckxpc3QobmV3U3RhdGUuaXRlbXMpO1xuICAgICAgICAgICAgYXdhaXQgY29ubi5hcGkucmVuZGVyKG5ld1N0YXRlLml0ZW1zKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIFJlY2VpdmVzIG1lc3NhZ2VzIGZyb20gQmFja2dyb3VuZCAoU1cpIOKGkiBQYW5lbC5cbiAgICBjaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoKG1zZykgPT4ge1xuICAgICAgICBpZiAobXNnPy50eXBlICE9PSBNU0dfVFlQRS5DTE9TRV9QQU5FTClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKGN1cnJlbnRUYWJJZCA9PT0gbnVsbCB8fCBtc2cucGF5bG9hZD8udGFiSWQgPT09IGN1cnJlbnRUYWJJZCkge1xuICAgICAgICAgICAgd2luZG93LmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBSZXN0b3JlXG4gICAgY29uc3Qgc3QgPSBhd2FpdCBnZXRTdGF0ZShjdXJyZW50UGFnZUtleSk7XG4gICAgYXdhaXQgY29ubi5hcGkucmVuZGVyKHN0Lml0ZW1zKTtcbiAgICByZW5kZXJMaXN0KHN0Lml0ZW1zKTtcbiAgICB1cGRhdGVTdGF0dXNVSShTVEFUVVMuQ09OTkVDVEVEKTtcbiAgICAvLyBUb2dnbGVzIHNlbGVjdGlvbiBtb2RlIGZyb20gdGhlIFBhbmVsIGFuZCBub3RpZmllcyBDb250ZW50LlxuICAgIHRvZ2dsZUJ0bi5vbmNsaWNrID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBzZWxlY3Rpb25FbmFibGVkID0gIXNlbGVjdGlvbkVuYWJsZWQ7XG4gICAgICAgIHVwZGF0ZVRvZ2dsZUljb25VSShzZWxlY3Rpb25FbmFibGVkKTtcbiAgICAgICAgYXdhaXQgY29ubi5hcGkudG9nZ2xlU2VsZWN0KHNlbGVjdGlvbkVuYWJsZWQpO1xuICAgIH07XG4gICAgLy8gQ2xlYXJzIGFsbCBzZWxlY3Rpb25zIGZyb20gc3RvcmFnZSBhbmQgdGhlIENvbnRlbnQgb3ZlcmxheS5cbiAgICBjbGVhckJ0bi5vbmNsaWNrID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBjbGVhcmVkID0geyBpdGVtczogW10sIG5leHRJZDogMSwgbmV4dExhYmVsOiAxIH07XG4gICAgICAgIGF3YWl0IHNldFN0YXRlKGN1cnJlbnRQYWdlS2V5LCBjbGVhcmVkKTtcbiAgICAgICAgcmVuZGVyTGlzdChbXSk7XG4gICAgICAgIGF3YWl0IGNvbm4uYXBpLmNsZWFyKCk7XG4gICAgfTtcbiAgICAvLyBJbml0aWF0ZXMgYSBmdWxsLXBhZ2Ugc2NyZWVuc2hvdCBvZiB0aGUgY3VycmVudCB0YWIgYW5kIHNhdmVzIGl0IHZpYSB0aGUgRG93bmxvYWRzIEFQSS5cbiAgICAvLyBFcnJvcnMgYXJlIGxvZ2dlZCB0byB0aGUgY29uc29sZSB3aXRob3V0IGludGVycnVwdGluZyB0aGUgVUkuXG4gICAgY2FwdHVyZUJ0bi5vbmNsaWNrID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgY2FwdHVyZUZ1bGxQYWdlKHsgdGFiSWQ6IGN1cnJlbnRUYWJJZCB9KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRnVsbCBjYXB0dXJlIGZhaWxlZCcsIGUpO1xuICAgICAgICB9XG4gICAgfTtcbn1cbiIsImV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3RpdmVUYWIoKSB7XG4gICAgY29uc3QgdGFicyA9IGF3YWl0IGNocm9tZS50YWJzLnF1ZXJ5KHsgYWN0aXZlOiB0cnVlLCBjdXJyZW50V2luZG93OiB0cnVlIH0pO1xuICAgIHJldHVybiB0YWJzWzBdO1xufVxuIiwiaW1wb3J0IHsgQ0hBTk5FTCB9IGZyb20gJ0Bjb21tb24vY29uc3RhbnRzJztcbmltcG9ydCB7IFBhbmVsQXBpIH0gZnJvbSAnLi9hcGknO1xuaW1wb3J0IHsgUG9ydFJwYyB9IGZyb20gJy4vcG9ydF9ycGMnO1xuLyoqXG4gKiBJbmplY3RzIHRoZSBjb250ZW50IHNjcmlwdCBpbnRvIHRoZSB0YWIgaWYgbmVlZGVkLCBhbmRcbiAqIGluaXRpYWxpemVzIHRoZSBQb3J0IGNvbm5lY3Rpb24gYW5kIFJQQyBmb3IgUGFuZWwg4oaUIENvbnRlbnQuXG4gKlxuICogQHBhcmFtIHRhYklkIC0gVGFyZ2V0IHRhYiBpZFxuICogQHJldHVybnMgQSBjb25uZWN0aW9uIG9iamVjdCBidW5kbGluZyBBUEksIFBvcnQsIGFuZCBSUENcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNvbm5lY3RUb1RhYih0YWJJZCkge1xuICAgIGF3YWl0IGNocm9tZS5zY3JpcHRpbmcuZXhlY3V0ZVNjcmlwdCh7XG4gICAgICAgIHRhcmdldDogeyB0YWJJZCB9LFxuICAgICAgICBmaWxlczogWydjb250ZW50L21haW4uanMnXVxuICAgIH0pLmNhdGNoKCgpID0+IHsgfSk7XG4gICAgY29uc3QgcG9ydCA9IGNocm9tZS50YWJzLmNvbm5lY3QodGFiSWQsIHsgbmFtZTogQ0hBTk5FTC5QQU5FTF9DT05URU5UIH0pO1xuICAgIGNvbnN0IHJwYyA9IG5ldyBQb3J0UnBjKHBvcnQpO1xuICAgIGNvbnN0IGFwaSA9IG5ldyBQYW5lbEFwaShycGMpO1xuICAgIGNvbnN0IGxpc3RlbmVycyA9IFtdO1xuICAgIHBvcnQub25EaXNjb25uZWN0LmFkZExpc3RlbmVyKCgpID0+IGxpc3RlbmVycy5mb3JFYWNoKGZuID0+IGZuKCkpKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBhcGksIHBvcnQsIHJwYyxcbiAgICAgICAgb25EaXNjb25uZWN0OiAoY2IpID0+IGxpc3RlbmVycy5wdXNoKGNiKSxcbiAgICAgICAgZGlzcG9zZTogKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBwb3J0LmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIHsgLyogbm8tb3AgKi8gfVxuICAgICAgICB9LFxuICAgIH07XG59XG4iLCJpbXBvcnQgeyBpc1Jlc3RyaWN0ZWQgfSBmcm9tICdAY29tbW9uL3VybCc7XG5pbXBvcnQgeyBhdHRhY2gsIGRldGFjaCwgc2VuZCB9IGZyb20gJ0BpbmZyYS9jZHAvY2RwX2NsaWVudCc7XG4vKipcbiAqIE5vcm1hbGl6ZXMgYSBzdHJpbmcgZm9yIHNhZmUgdXNlIGFzIGEgZmlsZW5hbWU6XG4gKiByZXBsYWNlcyByZXNlcnZlZCBjaGFyYWN0ZXJzLCBjb2xsYXBzZXMgd2hpdGVzcGFjZSwgYW5kIHRyaW1zIGVuZHMuXG4gKlxuICogQHBhcmFtIHMgLSBSYXcgc3RyaW5nIHRvIHNhbml0aXplLlxuICogQHJldHVybnMgU2FuaXRpemVkIGZpbGVuYW1lLXNhZmUgc3RyaW5nLlxuICovXG5mdW5jdGlvbiBzYW5pdGl6ZUZvckZpbGVuYW1lKHMpIHtcbiAgICByZXR1cm4gcy5yZXBsYWNlKC9bXFxcXC86Kj9cIjw+fF0vZywgJ18nKS5yZXBsYWNlKC9cXHMrL2csICcgJykudHJpbSgpO1xufVxuLyoqXG4gKiBCdWlsZHMgYSB0aW1lc3RhbXBlZCBmaWxlbmFtZSBmb3IgdGhlIGNhcHR1cmUgYmFzZWQgb24gdGhlIHRhYidzIHRpdGxlIG9yIGhvc3QuXG4gKiBUcnVuY2F0ZXMgdGhlIGJhc2UgbmFtZSB0byA4MCBjaGFyYWN0ZXJzIGFuZCBhcHBlbmRzIHRoZSBwcm9wZXIgZXh0ZW5zaW9uLlxuICpcbiAqIEBwYXJhbSB0YWIgLSBTb3VyY2UgdGFiICh0aXRsZS91cmwgdXNlZCBmb3IgbmFtaW5nKS5cbiAqIEBwYXJhbSBmbXQgLSBUYXJnZXQgaW1hZ2UgZm9ybWF0ICgncG5nJyB8ICdqcGVnJykuXG4gKiBAcmV0dXJucyBBIGZpbGVuYW1lIGxpa2UgYHBhZ2UtMjAyNS0wOC0xM1QxMC0yMC0zMC0wMDBaLnBuZ2AuXG4gKi9cbmZ1bmN0aW9uIG1ha2VGaWxlbmFtZSh0YWIsIGZtdCkge1xuICAgIGNvbnN0IHRpdGxlID0gdGFiLnRpdGxlICYmIHRhYi50aXRsZS50cmltKCkgPyB0YWIudGl0bGUgOiAnJztcbiAgICBsZXQgYmFzZSA9IHRpdGxlIHx8ICgoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVSTCh0YWIudXJsID8/ICcnKS5ob3N0IHx8ICdwYWdlJztcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCB7XG4gICAgICAgICAgICByZXR1cm4gJ3BhZ2UnO1xuICAgICAgICB9XG4gICAgfSkoKTtcbiAgICBiYXNlID0gc2FuaXRpemVGb3JGaWxlbmFtZShiYXNlKTtcbiAgICBpZiAoYmFzZS5sZW5ndGggPiA4MClcbiAgICAgICAgYmFzZSA9IGJhc2Uuc2xpY2UoMCwgODApO1xuICAgIGNvbnN0IHRzID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnJlcGxhY2UoL1s6Ll0vZywgJy0nKTtcbiAgICByZXR1cm4gYCR7YmFzZX0tJHt0c30uJHtmbXR9YDtcbn1cbi8qKlxuICogQ2FwdHVyZXMgYSBzaW5nbGUgZnVsbC1wYWdlIHNjcmVlbnNob3QgKGluY2x1ZGluZyBjb250ZW50IGJleW9uZCB0aGUgdmlld3BvcnQpXG4gKiBhbmQgc2F2ZXMgaXQgdmlhIHRoZSBEb3dubG9hZHMgQVBJLlxuICpcbiAqIEBwYXJhbSBvcHRzIC0gQ2FwdHVyZSBvcHRpb25zICh0YWIgaWQsIGZvcm1hdCwgcXVhbGl0eSwgc2NhbGUsIGV0Yy4pLlxuICogQHJldHVybnMgVGhlIGBkb3dubG9hZElkYCB3aGVuIHNhdmVkIHN1Y2Nlc3NmdWxseTsgYHVuZGVmaW5lZGAgd2hlbiBjYXB0dXJlIGlzIHNraXBwZWQuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYXB0dXJlRnVsbFBhZ2Uob3B0cykge1xuICAgIGNvbnN0IHRhYiA9IGF3YWl0IGNocm9tZS50YWJzLmdldChvcHRzLnRhYklkKTtcbiAgICBpZiAoIXRhYi5pZCB8fCBpc1Jlc3RyaWN0ZWQodGFiLnVybCkpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdDYXB0dXJpbmcgaXMgbm90IHBvc3NpYmxlIGR1ZSB0byByZXN0cmljdGVkIFVSTDonLCB0YWIudXJsKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB0YXJnZXQgPSB7IHRhYklkOiB0YWIuaWQgfTtcbiAgICBjb25zdCBmbXQgPSBvcHRzLmZvcm1hdCA/PyAncG5nJztcbiAgICBjb25zdCBzZXR0bGVNcyA9IG9wdHMuc2V0dGxlTXMgPz8gNTAwO1xuICAgIGNvbnN0IHNjYWxlID0gb3B0cy5zY2FsZSA/PyAxO1xuICAgIGF3YWl0IGF0dGFjaCh0YXJnZXQpO1xuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHNlbmQodGFyZ2V0LCAnUGFnZS5lbmFibGUnKTtcbiAgICAgICAgaWYgKG9wdHMuYnJpbmdUb0Zyb250ID8/IHRydWUpIHtcbiAgICAgICAgICAgIGF3YWl0IHNlbmQodGFyZ2V0LCAnUGFnZS5icmluZ1RvRnJvbnQnKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDU1MgY29udGVudCBkaW1lbnNpb25zIG9mIHRoZSBwYWdlXG4gICAgICAgIGNvbnN0IGxtID0gYXdhaXQgc2VuZCh0YXJnZXQsICdQYWdlLmdldExheW91dE1ldHJpY3MnKTtcbiAgICAgICAgY29uc3Qgd2lkdGggPSBNYXRoLm1heCgxLCBNYXRoLmNlaWwobG0uY3NzQ29udGVudFNpemU/LndpZHRoID8/IDEpIHwgMCk7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IE1hdGgubWF4KDEsIE1hdGguY2VpbChsbS5jc3NDb250ZW50U2l6ZT8uaGVpZ2h0ID8/IDEpIHwgMCk7XG4gICAgICAgIC8vIEF2b2lkIHJlcGVhdGVkIHZpZXdwb3J0IHN0aXRjaGluZzogb3ZlcnJpZGUgdmlld3BvcnQgdG8gY292ZXIgdGhlIGZ1bGwgcGFnZVxuICAgICAgICBhd2FpdCBzZW5kKHRhcmdldCwgJ0VtdWxhdGlvbi5zZXREZXZpY2VNZXRyaWNzT3ZlcnJpZGUnLCB7XG4gICAgICAgICAgICB3aWR0aCwgaGVpZ2h0LCBkZXZpY2VTY2FsZUZhY3RvcjogMSwgbW9iaWxlOiBmYWxzZSxcbiAgICAgICAgICAgIHNjcmVlbldpZHRoOiB3aWR0aCwgc2NyZWVuSGVpZ2h0OiBoZWlnaHQsIHBvc2l0aW9uWDogMCwgcG9zaXRpb25ZOiAwLFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gU2Nyb2xsIHRvIHRvcCAmIHdhaXQgYnJpZWZseSBmb3IgbGF5b3V0L2ltYWdlIHN0YWJpbGl6YXRpb25cbiAgICAgICAgYXdhaXQgc2VuZCh0YXJnZXQsICdSdW50aW1lLmV2YWx1YXRlJywgeyBleHByZXNzaW9uOiAnd2luZG93LnNjcm9sbFRvKDAsMCknIH0pO1xuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocikgPT4gc2V0VGltZW91dChyLCBzZXR0bGVNcykpO1xuICAgICAgICA7XG4gICAgICAgIC8vIEZ1bGwtc2l6ZSBjYXB0dXJlXG4gICAgICAgIGNvbnN0IGNsaXAgPSB7IHg6IDAsIHk6IDAsIHdpZHRoLCBoZWlnaHQsIHNjYWxlIH07XG4gICAgICAgIGNvbnN0IGNhcFBhcmFtcyA9IHtcbiAgICAgICAgICAgIGZvcm1hdDogZm10LFxuICAgICAgICAgICAgZnJvbVN1cmZhY2U6IHRydWUsXG4gICAgICAgICAgICBjYXB0dXJlQmV5b25kVmlld3BvcnQ6IHRydWUsXG4gICAgICAgICAgICBjbGlwLFxuICAgICAgICB9O1xuICAgICAgICBpZiAoZm10ID09PSAnanBlZycgJiYgdHlwZW9mIG9wdHMucXVhbGl0eSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGNhcFBhcmFtcy5xdWFsaXR5ID0gTWF0aC5taW4oMTAwLCBNYXRoLm1heCgwLCBNYXRoLnJvdW5kKG9wdHMucXVhbGl0eSkpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHNlbmQodGFyZ2V0LCAnUGFnZS5jYXB0dXJlU2NyZWVuc2hvdCcsIGNhcFBhcmFtcyk7XG4gICAgICAgIGNvbnN0IG1pbWUgPSBmbXQgPT09ICdwbmcnID8gJ2ltYWdlL3BuZycgOiAnaW1hZ2UvanBlZyc7XG4gICAgICAgIGNvbnN0IHVybCA9IGBkYXRhOiR7bWltZX07YmFzZTY0LCR7ZGF0YX1gO1xuICAgICAgICBjb25zdCBmaWxlbmFtZSA9IG9wdHMuZmlsZW5hbWUgPz8gbWFrZUZpbGVuYW1lKHRhYiwgZm10KTtcbiAgICAgICAgY29uc3QgZG93bmxvYWRJZCA9IGF3YWl0IGNocm9tZS5kb3dubG9hZHMuZG93bmxvYWQoe1xuICAgICAgICAgICAgdXJsLFxuICAgICAgICAgICAgZmlsZW5hbWUsXG4gICAgICAgICAgICBzYXZlQXM6IGZhbHNlLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRvd25sb2FkSWQ7XG4gICAgfVxuICAgIGZpbmFsbHkge1xuICAgICAgICAvLyBDbGVhciBvdmVycmlkZGVuIHZpZXdwb3J0IG1ldHJpY3NcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHNlbmQodGFyZ2V0LCAnRW11bGF0aW9uLmNsZWFyRGV2aWNlTWV0cmljc092ZXJyaWRlJyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggeyAvKiBuby1vcCAqLyB9XG4gICAgICAgIC8vIEFsd2F5cyBkZXRhY2hcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGRldGFjaCh0YXJnZXQpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIHsgLyogbm8tb3AgKi8gfVxuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJnZXQiLCJrZXkiLCJzdWJzIiwiY2hyb21lIiwiaTE4biIsImdldE1lc3NhZ2UiLCJsb2NhbGl6ZSIsInJvb3QiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZWwiLCJnZXRBdHRyaWJ1dGUiLCJ0ZXh0Q29udGVudCIsInNwZWMiLCJwYWlyIiwic3BsaXQiLCJhdHRyIiwibWFwIiwicyIsInRyaW0iLCJzZXRBdHRyaWJ1dGUiLCJNU0dfVFlQRSIsImlzUmVzdHJpY3RlZCIsInVybCIsInN0YXJ0c1dpdGgiLCJDSEFOTkVMIiwiUGFuZWxBcGkiLCJycGMiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJzZW5kIiwiYm9keSIsInJlcSIsImlkIiwiY3J5cHRvIiwicmFuZG9tVVVJRCIsImV4cGVjdFJlcGx5IiwicmVuZGVyIiwiaXRlbXMiLCJ0eXBlIiwicGF5bG9hZCIsInRvZ2dsZVNlbGVjdCIsImVuYWJsZWQiLCJjbGVhciIsInBpbmciLCJQb3J0UnBjIiwicG9ydCIsInBlbmRpbmciLCJNYXAiLCJvbk1lc3NhZ2UiLCJhZGRMaXN0ZW5lciIsIm1zZyIsImlzUmVzcG9uc2UiLCJkZWxldGUiLCJvbkRpc2Nvbm5lY3QiLCJyZXNvbHZlIiwib2siLCJlcnJvciIsInRpbWVvdXRNcyIsIlByb21pc2UiLCJ0aW1lciIsInNldFRpbWVvdXQiLCJ1bmRlZmluZWQiLCJzZXQiLCJyZXMiLCJjbGVhclRpbWVvdXQiLCJwb3N0TWVzc2FnZSIsImxhc3RFcnJvciIsImVyciIsInJ1bnRpbWUiLCJFcnJvciIsIm1lc3NhZ2UiLCJTdHJpbmciLCJhc3luYyIsInRhcmdldCIsIm1ldGhvZCIsInBhcmFtcyIsInJlamVjdCIsImRlYnVnZ2VyIiwic2VuZENvbW1hbmQiLCJyZXN1bHQiLCJST09UX0tFWSIsInJlYWRBbGwiLCJzdG9yYWdlIiwibG9jYWwiLCJnZXRTdGF0ZSIsInBhZ2VLZXkiLCJuZXh0SWQiLCJuZXh0TGFiZWwiLCJzZXRTdGF0ZSIsInBhZ2VLZXlTdHIiLCJzdGF0ZSIsIndyaXRlQWxsIiwiU1RBVFVTIiwiU1RBVFVTX01TR19LRVkiLCJSRVNUUklDVEVEIiwiQ09OTkVDVElORyIsIkNPTk5FQ1RFRCIsIkRJU0NPTk5FQ1RFRCIsIlNUQVRVU19MQUJFTF9TVFlMRSIsImRvdCIsInN0YXR1c0VsIiwiZ2V0RWxlbWVudEJ5SWQiLCJ0b2dnbGVJY29uRWwiLCJ0b2dnbGVMYWJlbEVsIiwic2VsZWN0Q291bnRFbCIsInNlbGVjdEVtcHR5RWwiLCJzZWxlY3RMaXN0RWwiLCJTVEFUVVNfQkFTRV9CT0RZIiwiVE9HR0xFX0lDT05fQkFTRSIsIlRPR0dMRV9JQ09OX09OIiwiVE9HR0xFX0lDT05fT0ZGIiwidXBkYXRlU3RhdHVzVUkiLCJzdHlsZSIsImNsYXNzTmFtZSIsImNsYXNzTGlzdCIsImFkZCIsImNyZWF0ZUVsZW1lbnQiLCJ0ZXh0IiwiaXNEaXNhYmxlZCIsIm1zZ0tleSIsImdldFN0YXR1c01lc3NhZ2UiLCJyZXBsYWNlQ2hpbGRyZW4iLCJidG4iLCJkaXNhYmxlZCIsInVwZGF0ZVRvZ2dsZUljb25VSSIsInJlbmRlckxpc3QiLCJpc0VtcHR5IiwibGVuZ3RoIiwicmVtb3ZlIiwiZnJhZyIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJpdCIsImxpIiwiZGF0YXNldCIsImJhZGdlIiwibGFiZWwiLCJtYWluIiwibGluZTEiLCJhbmNob3IiLCJ2YWx1ZSIsImFwcGVuZCIsImFwcGVuZENoaWxkIiwidG9nZ2xlQnRuIiwiY2xlYXJCdG4iLCJjYXB0dXJlQnRuIiwiY3VycmVudFRhYklkIiwiY3VycmVudFBhZ2VLZXkiLCJzZWxlY3Rpb25FbmFibGVkIiwidGFiIiwidGFicyIsInF1ZXJ5IiwiYWN0aXZlIiwiY3VycmVudFdpbmRvdyIsImdldEFjdGl2ZVRhYiIsImluY2x1ZGVIYXNoIiwidSIsIlVSTCIsIm9yaWdpbiIsInBhdGhuYW1lIiwic2VhcmNoIiwiaGFzaCIsImNvbm4iLCJ0YWJJZCIsInNjcmlwdGluZyIsImV4ZWN1dGVTY3JpcHQiLCJmaWxlcyIsImNhdGNoIiwiY29ubmVjdCIsIm5hbWUiLCJhcGkiLCJsaXN0ZW5lcnMiLCJmbiIsImNiIiwicHVzaCIsImRpc3Bvc2UiLCJkaXNjb25uZWN0IiwiY29ubmVjdFRvVGFiIiwibmV3U3RhdGUiLCJhbmNob3JzIiwidW5pcSIsIkFycmF5IiwiZnJvbSIsIlNldCIsImEiLCJ2IiwiZmluZCIsImZpbHRlciIsIkJvb2xlYW4iLCJyZW1vdmVkSWRzIiwidG9BZGQiLCJmb3VuZCIsImtpbmQiLCJwYXRjaCIsImFkZGVkIiwiaGFzUmVtb3ZhbCIsInRvUmVtb3ZlIiwiaGFzIiwidXBkYXRlZCIsImkiLCJtZXRhIiwicmVsYWJlbFNlcXVlbnRpYWwiLCJhcHBseVBhdGNoIiwiaGFuZGxlU2VsZWN0ZWQiLCJ3aW5kb3ciLCJjbG9zZSIsInN0Iiwib25jbGljayIsIm9wdHMiLCJjb25zb2xlIiwid2FybiIsImZtdCIsImZvcm1hdCIsInNldHRsZU1zIiwic2NhbGUiLCJhdHRhY2giLCJicmluZ1RvRnJvbnQiLCJsbSIsIndpZHRoIiwiTWF0aCIsIm1heCIsImNlaWwiLCJjc3NDb250ZW50U2l6ZSIsImhlaWdodCIsImRldmljZVNjYWxlRmFjdG9yIiwibW9iaWxlIiwic2NyZWVuV2lkdGgiLCJzY3JlZW5IZWlnaHQiLCJwb3NpdGlvblgiLCJwb3NpdGlvblkiLCJleHByZXNzaW9uIiwiciIsImNhcFBhcmFtcyIsImZyb21TdXJmYWNlIiwiY2FwdHVyZUJleW9uZFZpZXdwb3J0IiwiY2xpcCIsIngiLCJ5IiwicXVhbGl0eSIsIm1pbiIsInJvdW5kIiwiZGF0YSIsImZpbGVuYW1lIiwiYmFzZSIsInRpdGxlIiwiaG9zdCIsInJlcGxhY2UiLCJzbGljZSIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsIm1ha2VGaWxlbmFtZSIsImRvd25sb2FkcyIsImRvd25sb2FkIiwic2F2ZUFzIiwiZGV0YWNoIiwiY2FwdHVyZUZ1bGxQYWdlIiwiZSJdLCJzb3VyY2VSb290IjoiIn0=